import pytest

from alive_progress.animations.bars import standard_bar_factory, unknown_bar_factory


@pytest.mark.parametrize('chars, tip, background, percent, end, expected', [
    ('', '>', '', -.5, False, '|          |'),
    ('', '>', '0123', -.5, False, '|0123012301|'),
    ('', '@#$%>', '', -.5, False, '|          |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', -.5, False, '|0123456789|'),
    ('=', '', '', -.5, False, '|          |'),
    ('=', '', '.', -.5, False, '|..........|'),
    ('=', '>', '', -.5, False, '|          |'),
    ('=', '>', '0123', -.5, False, '|0123012301|'),
    ('=', '@#$%>', '', -.5, False, '|          |'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', -.5, False, '|0123456789|'),
    ('_-=', '', '', -.5, False, '|          |'),
    ('_-=', '', '.', -.5, False, '|..........|'),
    ('_-=', '>', '', -.5, False, '|          |'),
    ('_-=', '>', '0123', -.5, False, '|0123012301|'),
    ('_-=', '@#$%>', '', -.5, False, '|          |'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', -.5, False, '|0123456789|'),
    ('', '>', '', -.5, True, '|          |'),
    ('', '>', '0123', -.5, True, '|0123012301|'),
    ('', '@#$%>', '', -.5, True, '|          |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', -.5, True, '|0123456789|'),
    ('=', '', '', -.5, True, '|!         |'),
    ('=', '', '.', -.5, True, '|!         |'),
    ('=', '>', '', -.5, True, '|!         |'),
    ('=', '>', '0123', -.5, True, '|!         |'),
    ('=', '@#$%>', '', -.5, True, '|!         |'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', -.5, True, '|!         |'),
    ('_-=', '', '', -.5, True, '|!         |'),
    ('_-=', '', '.', -.5, True, '|!         |'),
    ('_-=', '>', '', -.5, True, '|!         |'),
    ('_-=', '>', '0123', -.5, True, '|!         |'),
    ('_-=', '@#$%>', '', -.5, True, '|!         |'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', -.5, True, '|!         |'),

    ('', '>', '', 0., False, '|          |'),
    ('', '>', '0123', 0., False, '|0123012301|'),
    ('', '@#$%>', '', 0., False, '|          |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 0., False, '|0123456789|'),
    ('=', '', '', 0., False, '|          |'),
    ('=', '', '.', 0., False, '|..........|'),
    ('=', '>', '', 0., False, '|          |'),
    ('=', '>', '0123', 0., False, '|0123012301|'),
    ('=', '@#$%>', '', 0., False, '|          |'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 0., False, '|0123456789|'),
    ('_-=', '', '', 0., False, '|          |'),
    ('_-=', '', '.', 0., False, '|..........|'),
    ('_-=', '>', '', 0., False, '|          |'),
    ('_-=', '>', '0123', 0., False, '|0123012301|'),
    ('_-=', '@#$%>', '', 0., False, '|          |'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 0., False, '|0123456789|'),
    ('', '>', '', 0., True, '|          |'),
    ('', '>', '0123', 0., True, '|0123012301|'),
    ('', '@#$%>', '', 0., True, '|          |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 0., True, '|0123456789|'),
    ('=', '', '', 0., True, '|!         |'),
    ('=', '', '.', 0., True, '|!         |'),
    ('=', '>', '', 0., True, '|!         |'),
    ('=', '>', '0123', 0., True, '|!         |'),
    ('=', '@#$%>', '', 0., True, '|!         |'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 0., True, '|!         |'),
    ('_-=', '', '', 0., True, '|!         |'),
    ('_-=', '', '.', 0., True, '|!         |'),
    ('_-=', '>', '', 0., True, '|!         |'),
    ('_-=', '>', '0123', 0., True, '|!         |'),
    ('_-=', '@#$%>', '', 0., True, '|!         |'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 0., True, '|!         |'),

    ('', '>', '', .15, False, '| >        |'),
    ('', '>', '0123', .15, False, '|0>23012301|'),
    ('', '@#$%>', '', .15, False, '|%>        |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .15, False, '|%>23456789|'),
    ('=', '', '', .15, False, '|==        |'),
    ('=', '', '.', .15, False, '|==........|'),
    ('=', '>', '', .15, False, '|=>        |'),
    ('=', '>', '0123', .15, False, '|=>23012301|'),
    ('=', '@#$%>', '', .15, False, '|%>        |'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .15, False, '|%>23456789|'),
    ('_-=', '', '', .15, False, '|=_        |'),
    ('_-=', '', '.', .15, False, '|=_........|'),
    ('_-=', '>', '', .15, False, '|->        |'),
    ('_-=', '>', '0123', .15, False, '|->23012301|'),
    ('_-=', '@#$%>', '', .15, False, '|$%>       |'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .15, False, '|$%>3456789|'),
    ('', '>', '', .15, True, '| !        |'),
    ('', '>', '0123', .15, True, '|0!        |'),
    ('', '@#$%>', '', .15, True, '|          |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .15, True, '|0123456789|'),
    ('=', '', '', .15, True, '|==!       |'),
    ('=', '', '.', .15, True, '|==!       |'),
    ('=', '>', '', .15, True, '|=!        |'),
    ('=', '>', '0123', .15, True, '|=!        |'),
    ('=', '@#$%>', '', .15, True, '|!         |'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .15, True, '|!         |'),
    ('_-=', '', '', .15, True, '|=_!       |'),
    ('_-=', '', '.', .15, True, '|=_!       |'),
    ('_-=', '>', '', .15, True, '|-!        |'),
    ('_-=', '>', '0123', .15, True, '|-!        |'),
    ('_-=', '@#$%>', '', .15, True, '|!         |'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .15, True, '|!         |'),

    ('', '>', '', .5, False, '|     >    |'),
    ('', '>', '0123', .5, False, '|01230>2301|'),
    ('', '@#$%>', '', .5, False, '|   @#$%>  |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .5, False, '|012@#$%>89|'),
    ('=', '', '', .5, False, '|=====     |'),
    ('=', '', '.', .5, False, '|=====.....|'),
    ('=', '>', '', .5, False, '|=====>    |'),
    ('=', '>', '0123', .5, False, '|=====>2301|'),
    ('=', '@#$%>', '', .5, False, '|===@#$%>  |'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .5, False, '|===@#$%>89|'),
    ('_-=', '', '', .5, False, '|=====     |'),
    ('_-=', '', '.', .5, False, '|=====.....|'),
    ('_-=', '>', '', .5, False, '|====_>    |'),
    ('_-=', '>', '0123', .5, False, '|====_>2301|'),
    ('_-=', '@#$%>', '', .5, False, '|==_@#$%>  |'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .5, False, '|==_@#$%>89|'),
    ('', '>', '', .5, True, '|     !    |'),
    ('', '>', '0123', .5, True, '|01230!    |'),
    ('', '@#$%>', '', .5, True, '|   !      |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .5, True, '|012!      |'),
    ('=', '', '', .5, True, '|=====!    |'),
    ('=', '', '.', .5, True, '|=====!    |'),
    ('=', '>', '', .5, True, '|=====!    |'),
    ('=', '>', '0123', .5, True, '|=====!    |'),
    ('=', '@#$%>', '', .5, True, '|===!      |'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .5, True, '|===!      |'),
    ('_-=', '', '', .5, True, '|=====!    |'),
    ('_-=', '', '.', .5, True, '|=====!    |'),
    ('_-=', '>', '', .5, True, '|====_!    |'),
    ('_-=', '>', '0123', .5, True, '|====_!    |'),
    ('_-=', '@#$%>', '', .5, True, '|==_!      |'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .5, True, '|==_!      |'),

    ('', '>', '', .85, False, '|        > |'),
    ('', '>', '0123', .85, False, '|01230123>1|'),
    ('', '@#$%>', '', .85, False, '|        @#|'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .85, False, '|01234567@#|'),
    ('=', '', '', .85, False, '|========  |'),
    ('=', '', '.', .85, False, '|========..|'),
    ('=', '>', '', .85, False, '|========> |'),
    ('=', '>', '0123', .85, False, '|========>1|'),
    ('=', '@#$%>', '', .85, False, '|========@#|'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .85, False, '|========@#|'),
    ('_-=', '', '', .85, False, '|========- |'),
    ('_-=', '', '.', .85, False, '|========-.|'),
    ('_-=', '>', '', .85, False, '|========_>|'),
    ('_-=', '>', '0123', .85, False, '|========_>|'),
    ('_-=', '@#$%>', '', .85, False, '|=======-@#|'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .85, False, '|=======-@#|'),
    ('', '>', '', .85, True, '|        ! |'),
    ('', '>', '0123', .85, True, '|01230123! |'),
    ('', '@#$%>', '', .85, True, '|        ! |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .85, True, '|01234567! |'),
    ('=', '', '', .85, True, '|========! |'),
    ('=', '', '.', .85, True, '|========! |'),
    ('=', '>', '', .85, True, '|========! |'),
    ('=', '>', '0123', .85, True, '|========! |'),
    ('=', '@#$%>', '', .85, True, '|========! |'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .85, True, '|========! |'),
    ('_-=', '', '', .85, True, '|========-!|'),
    ('_-=', '', '.', .85, True, '|========-!|'),
    ('_-=', '>', '', .85, True, '|========_!|'),
    ('_-=', '>', '0123', .85, True, '|========_!|'),
    ('_-=', '@#$%>', '', .85, True, '|=======-! |'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', .85, True, '|=======-! |'),

    ('', '>', '', 1., False, '|          |'),
    ('', '>', '0123', 1., False, '|0123012301|'),
    ('', '@#$%>', '', 1., False, '|          |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1., False, '|0123456789|'),
    ('=', '', '', 1., False, '|==========|'),
    ('=', '', '.', 1., False, '|==========|'),
    ('=', '>', '', 1., False, '|==========|'),
    ('=', '>', '0123', 1., False, '|==========|'),
    ('=', '@#$%>', '', 1., False, '|==========|'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1., False, '|==========|'),
    ('_-=', '', '', 1., False, '|==========|'),
    ('_-=', '', '.', 1., False, '|==========|'),
    ('_-=', '>', '', 1., False, '|==========|'),
    ('_-=', '>', '0123', 1., False, '|==========|'),
    ('_-=', '@#$%>', '', 1., False, '|==========|'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1., False, '|==========|'),
    ('', '>', '', 1., True, '|          |'),
    ('', '>', '0123', 1., True, '|0123012301|'),
    ('', '@#$%>', '', 1., True, '|          |'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1., True, '|0123456789|'),
    ('=', '', '', 1., True, '|==========|'),
    ('=', '', '.', 1., True, '|==========|'),
    ('=', '>', '', 1., True, '|==========|'),
    ('=', '>', '0123', 1., True, '|==========|'),
    ('=', '@#$%>', '', 1., True, '|==========|'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1., True, '|==========|'),
    ('_-=', '', '', 1., True, '|==========|'),
    ('_-=', '', '.', 1., True, '|==========|'),
    ('_-=', '>', '', 1., True, '|==========|'),
    ('_-=', '>', '0123', 1., True, '|==========|'),
    ('_-=', '@#$%>', '', 1., True, '|==========|'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1., True, '|==========|'),

    ('', '>', '', 1.5, False, '|          x'),
    ('', '>', '0123', 1.5, False, '|0123012301x'),
    ('', '@#$%>', '', 1.5, False, '|          x'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1.5, False, '|0123456789x'),
    ('=', '', '', 1.5, False, '|==========x'),
    ('=', '', '.', 1.5, False, '|==========x'),
    ('=', '>', '', 1.5, False, '|==========x'),
    ('=', '>', '0123', 1.5, False, '|==========x'),
    ('=', '@#$%>', '', 1.5, False, '|==========x'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1.5, False, '|==========x'),
    ('_-=', '', '', 1.5, False, '|==========x'),
    ('_-=', '', '.', 1.5, False, '|==========x'),
    ('_-=', '>', '', 1.5, False, '|==========x'),
    ('_-=', '>', '0123', 1.5, False, '|==========x'),
    ('_-=', '@#$%>', '', 1.5, False, '|==========x'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1.5, False, '|==========x'),
    ('', '>', '', 1.5, True, '|          x'),
    ('', '>', '0123', 1.5, True, '|0123012301x'),
    ('', '@#$%>', '', 1.5, True, '|          x'),
    ('', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1.5, True, '|0123456789x'),
    ('=', '', '', 1.5, True, '|==========x'),
    ('=', '', '.', 1.5, True, '|==========x'),
    ('=', '>', '', 1.5, True, '|==========x'),
    ('=', '>', '0123', 1.5, True, '|==========x'),
    ('=', '@#$%>', '', 1.5, True, '|==========x'),
    ('=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1.5, True, '|==========x'),
    ('_-=', '', '', 1.5, True, '|==========x'),
    ('_-=', '', '.', 1.5, True, '|==========x'),
    ('_-=', '>', '', 1.5, True, '|==========x'),
    ('_-=', '>', '0123', 1.5, True, '|==========x'),
    ('_-=', '@#$%>', '', 1.5, True, '|==========x'),
    ('_-=', '@#$%>', '0123456789xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 1.5, True, '|==========x'),
])
def test_standard_bar_draw(chars, tip, background, percent, end, expected):
    bar_gen = standard_bar_factory(chars=chars, tip=tip, background=background,
                                   borders='||', errors='!x')(length=10)
    rendition = bar_gen(percent=percent, end=end)
    assert rendition == expected
    assert len(rendition) == 12  # length + borders


def test_standard_bar_error():
    with pytest.raises(ValueError):
        standard_bar_factory(chars='', tip='')


def test_unknown_bar(spinner_test):
    bar_gen = unknown_bar_factory(spinner_test(('1234567890',)))(length=10)
    assert bar_gen() == '|1234567890|'
